<!DOCTYPE html>
<html>
<head>
    <title>Corynth Training - Lesson 1: First Workflow</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <div class="window-controls">
                <div class="control close"></div>
                <div class="control minimize"></div>
                <div class="control maximize"></div>
            </div>
            <div class="terminal-title">Lesson 1: First Workflow - Corynth Training</div>
            <div style="clear: both;"></div>
        </div>
        <div id="content"></div>
    </div>
    
    <a href="training-index.html" class="main-menu-btn">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/>
        </svg>
        Main Menu
    </a>
    
    <div class="controls-hint">
        SPACE: Pause Auto-play<br/>
        Q/A: Scroll Up/Down<br/>
        R: Restart<br/>
        M: Main Menu
    </div>
    
    <div class="pause-overlay">
        <div class="pause-dialog">
            <h2>Lesson Paused</h2>
            <p>Take your time to review the content. When you're ready, continue to the next section or choose another option.</p>
            <div class="pause-buttons">
                <button class="pause-btn primary" onclick="continueLesson()">Continue</button>
                <button class="pause-btn" onclick="restartLesson()">Restart</button>
                <button class="pause-btn" onclick="returnToMainMenu()">Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        const lessonContent = [
            {
                type: 'intro',
                text: '<span class="highlight">Lesson 1: Your First Workflow</span>',
                delay: 1500
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>What You\'ll Learn:</strong><br/>• Basic HCL syntax for workflows<br/>• Workflow structure (metadata + steps)<br/>• Using the built-in shell plugin<br/>• Validation and execution commands</div>',
                delay: 2200
            },
            {
                type: 'prompt',
                command: 'mkdir corynth-tutorial && cd corynth-tutorial',
                delay: 800
            },
            {
                type: 'output',
                text: '<span class="info">Created project directory</span>',
                delay: 800
            },
            {
                type: 'prompt',
                command: 'corynth init',
                delay: 1200
            },
            {
                type: 'output',
                text: 'Initializing Corynth...\n• Loading configuration from corynth.hcl...\n<span class="success">Configuration validated</span>\n<span class="success">Created .corynth directory structure</span>\n• Initializing plugin system...\nLoaded plugins <span class="success">(6)</span>\n  •  reporting <span class="success">v1.0.0</span> - Generate formatted reports with tables, charts, and multiple output formats\n  •  git <span class="success">v1.0.0</span> - Git version control operations\n  •  slack <span class="success">v1.0.0</span> - Slack messaging and notification operations\n  •  shell <span class="success">v1.0.0</span> - Execute shell commands and scripts\n  •  http <span class="success">v1.0.0</span> - HTTP client for REST API calls and web requests\n  •  file <span class="success">v1.0.0</span> - File system operations (read, write, copy, move)\n<span class="success">Plugin system initialized</span>\n• Scanning for workflow files...\n<span class="info">No workflow files found</span>\n• Initializing local state backend...\n<span class="success">State backend initialized</span>\n\n<span class="success">Corynth has been successfully initialized!</span>\n\nYou can now run workflows with:\n  •  corynth sample - Generate sample workflows\n  •  corynth plan - Preview workflow execution\n  •  corynth apply - Execute workflow\n\n<span class="info">To get started, generate a sample workflow file.</span>',
                delay: 3000
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Creating Your First Workflow</strong><br/>Let\'s create a simple "Hello World" workflow using HCL syntax.<br/>HCL (HashiCorp Configuration Language) is human-readable and easy to learn.</div>',
                delay: 2000
            },
            {
                type: 'prompt',
                command: 'cat > hello.hcl << EOF',
                delay: 600
            },
            {
                type: 'output',
                text: `<div class="multi-line-copyable">
<button class="multi-line-copy-btn" onclick="copyToClipboard(\`workflow "hello" {
  description = "My first workflow"
  version     = "1.0.0"

  step "greet" {
    plugin = "shell"
    action = "exec"
    
    params = {
      command = "echo 'Hello, Corynth!'"
    }
  }
}\`, this)">Copy</button>workflow "hello" {
  description = "My first workflow"
  version     = "1.0.0"

  step "greet" {
    plugin = "shell"
    action = "exec"
    
    params = {
      command = "echo 'Hello, Corynth!'"
    }
  }
}
EOF</div>`,
                delay: 800
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Let\'s view the file we just created:</strong></div>',
                delay: 400
            },
            {
                type: 'prompt',
                command: 'cat hello.hcl',
                delay: 500
            },
            {
                type: 'output',
                text: '<span class="keyword">workflow</span> <span class="string">"hello"</span> <span class="bracket">{</span>\n  <span class="property">description</span> <span class="operator">=</span> <span class="string">"My first workflow"</span>\n  <span class="property">version</span>     <span class="operator">=</span> <span class="string">"1.0.0"</span>\n\n  <span class="keyword">step</span> <span class="string">"greet"</span> <span class="bracket">{</span>\n    <span class="property">plugin</span> <span class="operator">=</span> <span class="string">"shell"</span>\n    <span class="property">action</span> <span class="operator">=</span> <span class="string">"exec"</span>\n    \n    <span class="property">params</span> <span class="operator">=</span> <span class="bracket">{</span>\n      <span class="property">command</span> <span class="operator">=</span> <span class="string">"echo \'Hello, Corynth!\'"</span>\n    <span class="bracket">}</span>\n  <span class="bracket">}</span>\n<span class="bracket">}</span>',
                delay: 600
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Understanding the Workflow Structure:</strong><br/>• <code>workflow "hello"</code> - Declares a workflow named "hello"<br/>• <code>description</code> & <code>version</code> - Metadata for documentation<br/>• <code>step "greet"</code> - Defines a step named "greet"<br/>• <code>plugin = "shell"</code> - Uses the built-in shell plugin<br/>• <code>action = "exec"</code> - Executes a shell command<br/>• <code>params</code> - Parameters passed to the plugin action</div>',
                delay: 2500
            },
            {
                type: 'checkpoint',
                text: '<div class="checkpoint"><strong>Checkpoint:</strong> You\'ve created your first HCL workflow file!<br/>The file defines a single step that uses the shell plugin to echo a message.</div>',
                delay: 1800
            },
            {
                type: 'prompt',
                command: 'corynth validate hello.hcl',
                delay: 600
            },
            {
                type: 'output',
                text: '• Validating hello.hcl...\n<span class="success">Workflow is valid</span>\nName: hello\nDescription: My first workflow\nSteps: 1',
                delay: 500
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Planning Execution</strong><br/>Let\'s first preview what Corynth will do with <code>corynth plan</code>.</div>',
                delay: 600
            },
            {
                type: 'prompt',
                command: 'corynth plan hello.hcl',
                delay: 600
            },
            {
                type: 'output',
                text: '• Loading workflow from hello.hcl...\n\nPlanning workflow execution...\n\nExecution Plan for \'hello\':\n========================\n  <span class="highlight">#</span> | <span class="highlight">STEP </span> | <span class="highlight">PLUGIN</span> | <span class="highlight">ACTION</span> | <span class="highlight">EST  TIME</span>  \n----+-------+--------+--------+------------\n  1 | greet | shell  | exec   | 30s        \n\nPlan Summary\n============\nWorkflow: hello\nDescription: My first workflow\nSteps: 1\nEstimated Duration: 30s\n\n<span class="info">To execute this plan, run: corynth apply</span>',
                delay: 800
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Time to Execute!</strong><br/>The <code>plan</code> command shows what will happen without executing.<br/>Now let\'s run the workflow with <code>corynth apply</code>.</div>',
                delay: 600
            },
            {
                type: 'prompt',
                command: 'corynth apply hello.hcl',
                delay: 800
            },
            {
                type: 'output',
                text: '• Loading workflow from hello.hcl...\n\nWorkflow: hello\nDescription: My first workflow\nSteps to execute: 1\nEstimated duration: 30s\n\nSteps:\n  •  1. greet (<span class="success">shell</span>.<span class="success">exec</span>)\n\n<span class="info">Do you want to execute this workflow? (yes/no):</span> <span class="info">Execution cancelled.</span>',
                delay: 800
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Using Auto-Approve</strong><br/>Let\'s use the <code>--auto-approve</code> flag to skip the confirmation prompt.</div>',
                delay: 500
            },
            {
                type: 'prompt',
                command: 'corynth apply hello.hcl --auto-approve',
                delay: 600
            },
            {
                type: 'output',
                text: '• Loading workflow from hello.hcl...\n\nWorkflow: hello\nDescription: My first workflow\nSteps to execute: 1\nEstimated duration: 30s\n\nSteps:\n  •  1. greet (<span class="success">shell</span>.<span class="success">exec</span>)\n\nStarting workflow execution...\nHello, Corynth!\n\n<span class="success">Workflow completed: hello</span>\nDuration: 0s\nSteps: 1/1',
                delay: 800
            },
            {
                type: 'checkpoint',
                text: '<div class="checkpoint"><strong>Success!</strong> You\'ve executed your first Corynth workflow!<br/>• Corynth parsed the HCL file<br/>• Loaded the shell plugin<br/>• Executed the command<br/>• Saved the execution state</div>',
                delay: 2000
            },
            {
                type: 'try-it',
                text: '<div class="try-it"><strong>Try It Yourself:</strong><br/>1. Modify the echo message in hello.hcl<br/>2. Add a second step that prints the current date<br/>3. Run <code>corynth apply hello.hcl --auto-approve</code> again<br/><br/><strong>Hint:</strong> Use <code>command = "date"</code> for the date step!</div>',
                delay: 2500
            },
            {
                type: 'prompt',
                command: 'corynth state list',
                delay: 600
            },
            {
                type: 'output',
                text: 'Recent executions <span class="success">(1)</span>\n  •  <span class="success">82d828ab</span>: hello (success) - <span class="success">0s</span>',
                delay: 600
            },
            {
                type: 'explanation',
                text: '<div class="explanation"><strong>Execution History</strong><br/>Corynth automatically tracks all workflow executions with:<br/>• Unique execution ID<br/>• Workflow name and status<br/>• Execution duration<br/>• Timestamp information</div>',
                delay: 600
            },
            {
                type: 'conclusion',
                text: '<div class="checkpoint"><strong>Lesson 1 Complete!</strong><br/><br/><strong>What You\'ve Mastered:</strong><br/>• HCL workflow syntax and structure<br/>• Using the shell plugin for command execution<br/>• Validating workflows before execution<br/>• Running workflows with corynth apply<br/>• Viewing execution history<br/><br/><strong>Next:</strong> Lesson 2 covers variables and parameters for dynamic workflows!</div>',
                delay: 3000
            }
        ];

        let currentIndex = 0;
        const contentEl = document.getElementById('content');
        let isPaused = false;
        let autoPlay = true;
        let pauseCallback = null;

        function typeText(text, element, callback, speed = 20) {
            let i = 0;
            const typeChar = () => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    if (i % 10 === 0) {
                        const terminal = document.querySelector('.terminal');
                        terminal.scrollTop = terminal.scrollHeight;
                    }
                    i++;
                    setTimeout(typeChar, speed + Math.random() * 10);
                } else {
                    if (callback) callback();
                }
            };
            typeChar();
        }

        function addLine(content, className = '', callback) {
            const lines = content.split(/\\n|\n/);
            let lineIndex = 0;
            
            function addNextLine() {
                if (lineIndex >= lines.length) {
                    if (callback) callback();
                    return;
                }
                
                const lineContent = lines[lineIndex];
                const line = document.createElement('div');
                line.className = `line fade-in ${className}`;
                
                if (lineContent.trim() === '') {
                    line.innerHTML = '&nbsp;';
                    line.style.minHeight = '20px';
                } else {
                    if (lineContent.includes('<')) {
                        line.innerHTML = lineContent;
                    } else {
                        line.textContent = lineContent;
                    }
                }
                
                contentEl.appendChild(line);
                
                const terminal = document.querySelector('.terminal');
                terminal.scrollTop = terminal.scrollHeight;
                
                lineIndex++;
                setTimeout(addNextLine, 80);
            }
            
            addNextLine();
        }

        function showCommand(cmd, callback) {
            const container = document.createElement('div');
            container.className = 'copyable-line fade-in line';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'copyable-content';
            
            // Create realistic shell prompt: user@host:~/path$ 
            const userSpan = document.createElement('span');
            userSpan.className = 'shell-user';
            userSpan.textContent = 'devops';
            
            const atSpan = document.createElement('span');
            atSpan.style.color = '#d4d4d4';
            atSpan.textContent = '@';
            
            const hostSpan = document.createElement('span');
            hostSpan.className = 'shell-host';
            hostSpan.textContent = 'corynth-demo';
            
            const colonSpan = document.createElement('span');
            colonSpan.style.color = '#d4d4d4';
            colonSpan.textContent = ':';
            
            const pathSpan = document.createElement('span');
            pathSpan.className = 'shell-path';
            pathSpan.textContent = '~/corynth-tutorial';
            
            const promptSpan = document.createElement('span');
            promptSpan.className = 'prompt';
            promptSpan.textContent = '$ ';
            
            contentDiv.appendChild(userSpan);
            contentDiv.appendChild(atSpan);
            contentDiv.appendChild(hostSpan);
            contentDiv.appendChild(colonSpan);
            contentDiv.appendChild(pathSpan);
            contentDiv.appendChild(promptSpan);
            
            const commandSpan = document.createElement('span');
            commandSpan.className = 'command';
            contentDiv.appendChild(commandSpan);
            
            // Add copy button
            const copyBtn = createCopyButton(cmd);
            
            container.appendChild(contentDiv);
            container.appendChild(copyBtn);
            contentEl.appendChild(container);
            
            const terminal = document.querySelector('.terminal');
            terminal.scrollTop = terminal.scrollHeight;
            
            typeText(cmd, commandSpan, () => {
                terminal.scrollTop = terminal.scrollHeight;
                callback();
            }, 30);
        }

        function pauseForInput(callback) {
            if (!autoPlay) {
                isPaused = true;
                pauseCallback = callback;
                document.querySelector('.pause-overlay').classList.add('show');
            } else {
                callback();
            }
        }
        
        function continueLesson() {
            if (isPaused && pauseCallback) {
                isPaused = false;
                document.querySelector('.pause-overlay').classList.remove('show');
                const callback = pauseCallback;
                pauseCallback = null;
                callback();
            }
        }
        
        function restartLesson() {
            currentIndex = 0;
            isPaused = false;
            autoPlay = true;
            contentEl.innerHTML = '';
            document.querySelector('.pause-overlay').classList.remove('show');
            updateControlsHint();
            setTimeout(runLesson, 1000);
        }
        
        function returnToMainMenu() {
            window.location.href = 'training-index.html';
        }
        
        // Smart pause logic: analyze lesson content to determine optimal pause points
        function addSmartPauseLogic() {
            const infoBlockTypes = ['explanation', 'checkpoint', 'try-it'];
            
            for (let i = 0; i < lessonContent.length; i++) {
                const current = lessonContent[i];
                
                // Always pause by default
                current.shouldPause = true;
                
                // Check if this is an info block
                if (infoBlockTypes.includes(current.type)) {
                    // Check if the next item is also an info block
                    let nextInfoBlockIndex = i + 1;
                    
                    // Skip any non-info blocks to find the next info block
                    while (nextInfoBlockIndex < lessonContent.length && 
                           !infoBlockTypes.includes(lessonContent[nextInfoBlockIndex].type)) {
                        nextInfoBlockIndex++;
                    }
                    
                    // If we found another info block right after (or very close), don't pause here
                    if (nextInfoBlockIndex < lessonContent.length && 
                        nextInfoBlockIndex - i <= 3) { // Allow up to 2 non-info items between
                        current.shouldPause = false;
                    }
                }
            }
        }

        function runLesson() {
            if (currentIndex >= lessonContent.length) return;
            
            const content = lessonContent[currentIndex];
            
            switch(content.type) {
                case 'intro':
                case 'conclusion':
                    addLine(content.text, 'highlight', () => {
                        currentIndex++;
                        if (content.shouldPause !== false) {
                            pauseForInput(() => {
                                setTimeout(runLesson, autoPlay ? content.delay : 100);
                            });
                        } else {
                            setTimeout(runLesson, autoPlay ? content.delay : 100);
                        }
                    });
                    break;
                    
                case 'explanation':
                case 'checkpoint':
                case 'try-it':
                    addLine(content.text, '', () => {
                        currentIndex++;
                        if (content.shouldPause !== false) {
                            pauseForInput(() => {
                                setTimeout(runLesson, autoPlay ? content.delay : 100);
                            });
                        } else {
                            setTimeout(runLesson, autoPlay ? content.delay : 100);
                        }
                    });
                    break;
                    
                case 'prompt':
                    showCommand(content.command, () => {
                        currentIndex++;
                        if (content.shouldPause !== false) {
                            pauseForInput(() => {
                                setTimeout(runLesson, autoPlay ? content.delay : 100);
                            });
                        } else {
                            setTimeout(runLesson, autoPlay ? content.delay : 100);
                        }
                    });
                    break;
                    
                case 'output':
                    addLine(content.text, 'output', () => {
                        currentIndex++;
                        if (content.shouldPause !== false) {
                            pauseForInput(() => {
                                setTimeout(runLesson, autoPlay ? content.delay : 100);
                            });
                        } else {
                            setTimeout(runLesson, autoPlay ? content.delay : 100);
                        }
                    });
                    break;
            }
        }

        // Add keyboard controls
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                if (isPaused) {
                    continueLesson();
                } else {
                    // Toggle autoplay mode
                    autoPlay = !autoPlay;
                    updateControlsHint();
                }
            } else if (e.key === 'q' || e.key === 'Q') {
                // Scroll up
                const terminal = document.querySelector('.terminal');
                terminal.scrollTop = Math.max(0, terminal.scrollTop - 200);
            } else if (e.key === 'a' || e.key === 'A') {
                // Scroll down  
                const terminal = document.querySelector('.terminal');
                terminal.scrollTop = terminal.scrollTop + 200;
            } else if (e.key === 'r' || e.key === 'R') {
                restartLesson();
            } else if (e.key === 'm' || e.key === 'M') {
                returnToMainMenu();
            }
        });
        
        function updateControlsHint() {
            const hint = document.querySelector('.controls-hint');
            if (autoPlay) {
                hint.innerHTML = 'SPACE: Pause Auto-play<br/>Q/A: Scroll Up/Down<br/>R: Restart<br/>M: Main Menu';
            } else {
                hint.innerHTML = 'SPACE: Continue<br/>Q/A: Scroll Up/Down<br/>R: Restart<br/>M: Main Menu';
            }
        }
        
        // Copy functionality
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const originalText = button.textContent;
                button.textContent = 'Copied';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }
        
        function createCopyButton(text, className = 'copy-btn') {
            const button = document.createElement('button');
            button.className = className;
            button.textContent = 'Copy';
            button.onclick = () => copyToClipboard(text, button);
            return button;
        }

        // Make functions globally accessible for onclick handlers
        window.continueLesson = continueLesson;
        window.restartLesson = restartLesson;
        window.returnToMainMenu = returnToMainMenu;
        window.copyToClipboard = copyToClipboard;
        window.createCopyButton = createCopyButton;
        
        updateControlsHint();
        addSmartPauseLogic();
        setTimeout(runLesson, 1000);
    </script>
</body>
</html>