<!DOCTYPE html>
<html>
<head>
    <title>Corynth Training - Lesson 8: Practice Exercises</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <div class="window-controls">
                <div class="control close"></div>
                <div class="control minimize"></div>
                <div class="control maximize"></div>
            </div>
            <div class="terminal-title">Lesson 8: Practice Exercises - Corynth Training</div>
            <div style="clear: both;"></div>
        </div>
        <div id="content"></div>
    </div>

    <!-- Navigation overlays -->
    <div class="controls-hint">
        SPACE: Pause | Q/A: Scroll | R: Restart | M: Main Menu
    </div>

    <a href="training-index.html" class="main-menu-btn">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
            <path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/>
        </svg>
        Main Menu
    </a>

    <div class="pause-overlay" id="pauseOverlay">
        <div class="pause-dialog">
            <h3>Lesson Paused</h3>
            <p>Choose an option to continue:</p>
            <div class="pause-buttons">
                <button class="pause-btn" onclick="resumeLesson()">Continue</button>
                <button class="pause-btn" onclick="restartLesson()">Restart</button>
                <button class="pause-btn" onclick="window.location.href='training-index.html'">Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        const lessonContent = [
            {
                type: 'intro',
                text: '<span class="highlight">Lesson 8: Practice Exercises</span>',
                delay: 800
            },
            {
                type: 'try-it',
                text: '<div class="try-it"><strong>Challenge 1: API Integration Pipeline</strong><br/>Create a workflow that:<br/>1. Fetches data from 3 different APIs in parallel<br/>2. Combines the results using shell commands<br/>3. Saves the processed data to a file<br/>4. Sends a completion notification<br/><br/><strong>APIs to use:</strong><br/>• https://httpbin.org/uuid<br/>• https://httpbin.org/ip<br/>• https://api.github.com/zen</div>',
                delay: 800
            },
            {
                type: 'prompt',
                command: 'cat > challenge1-solution.hcl << EOF',
                delay: 600
            },
            {
                type: 'output',
                text: 'workflow "api-integration-pipeline" {\n  description = "Multi-API data processing workflow"\n\n  # Parallel API calls\n  step "fetch_uuid" {\n    plugin = "http"\n    action = "get"\n    params = {\n      url = "https://httpbin.org/uuid"\n    }\n  }\n\n  step "fetch_ip" {\n    plugin = "http"\n    action = "get"\n    params = {\n      url = "https://httpbin.org/ip"\n    }\n  }\n\n  step "fetch_zen" {\n    plugin = "http"\n    action = "get"\n    params = {\n      url = "https://api.github.com/zen"\n    }\n  }\n\n  # Combine results\n  step "process_data" {\n    plugin = "shell"\n    action = "exec"\n    depends_on = ["fetch_uuid", "fetch_ip", "fetch_zen"]\n    params = {\n      command = "echo \'Processing complete: UUID, IP, and Zen data combined\' > /tmp/api_results.txt"\n    }\n  }\n\n  # Notification\n  step "notify_complete" {\n    plugin = "shell"\n    action = "exec"\n    depends_on = ["process_data"]\n    params = {\n      command = "echo \'Pipeline completed successfully at $(date)\' >> /tmp/api_results.txt && cat /tmp/api_results.txt"\n    }\n  }\n}\nEOF',
                delay: 1000
            },
            {
                type: 'try-it',
                text: '<div class="try-it"><strong>Challenge 2: Deployment Pipeline</strong><br/>Build a complete CI/CD workflow:<br/>1. Health check the deployment target<br/>2. Download application artifacts (parallel)<br/>3. Run pre-deployment validation<br/>4. Deploy with rollback on failure<br/>5. Post-deployment verification<br/><br/><strong>Bonus:</strong> Add retry policies and error handling!</div>',
                delay: 800
            },
            {
                type: 'prompt',
                command: 'cat > challenge2-solution.hcl << EOF',
                delay: 600
            },
            {
                type: 'output',
                text: 'workflow "deployment-pipeline" {
  description = "Complete CI/CD deployment workflow"

  step "health_check_target" {
    plugin = "http"
    action = "get"
    params = {
      url = "https://httpbin.org/status/200"
    }
    retry {
      max_attempts = 3
      delay = "5s"
    }
  }

  # Parallel artifact downloads
  step "download_app" {
    plugin = "shell"
    action = "exec"
    depends_on = ["health_check_target"]
    params = {
      command = "echo 'Downloaded app.zip' && touch /tmp/app.zip"
    }
  }

  step "download_config" {
    plugin = "shell"
    action = "exec"
    depends_on = ["health_check_target"]
    params = {
      command = "echo 'Downloaded config.json' && touch /tmp/config.json"
    }
  }

  step "pre_deploy_validation" {
    plugin = "shell"
    action = "exec"
    depends_on = ["download_app", "download_config"]
    params = {
      command = "echo 'Validation passed: artifacts ready'"
    }
  }

  step "deploy" {
    plugin = "shell"
    action = "exec"
    depends_on = ["pre_deploy_validation"]
    params = {
      command = "echo 'Deployment successful'"
    }
    continue_on { error = true }
  }

  step "post_deploy_verify" {
    plugin = "http"
    action = "get"
    depends_on = ["deploy"]
    params = {\\n      url = \"https://httpbin.org/status/200\"\\n    }\\n  }\\n}\\nEOF',
                delay: 1000
            },
            {
                type: 'try-it',
                text: '<div class="try-it"><strong>Challenge 3: Monitoring Workflow</strong><br/>Create a comprehensive monitoring solution:<br/>1. Check multiple services (parallel)<br/>2. Collect system metrics (disk, memory)<br/>3. Generate alerts for failures<br/>4. Create monitoring dashboard data<br/>5. Archive results for historical analysis<br/><br/><strong>Advanced:</strong> Use variables for configuration!</div>',
                delay: 800
            },
            {
                type: 'prompt',
                command: 'cat > challenge3-solution.hcl << EOF',
                delay: 600
            },
            {
                type: 'output',
                text: `workflow "comprehensive-monitoring" {
  description = "Multi-service monitoring with metrics"

  variable "alert_threshold" {
    type = string
    default = "90"
  }

  # Parallel service checks
  step "check_web_service" {
    plugin = "http"
    action = "get"
    params = {
      url = "https://httpbin.org/status/200"
    }
    continue_on { error = true }
  }

  step "check_api_service" {
    plugin = "http"
    action = "get"
    params = {
      url = "https://api.github.com/zen"
    }
    continue_on { error = true }
  }

  step "collect_disk_metrics" {
    plugin = "shell"
    action = "exec"
    params = {
      command = "df -h | head -2 > /tmp/disk_metrics.txt"
    }
  }

  step "collect_memory_metrics" {
    plugin = "shell"
    action = "exec"
    params = {
      command = "free -m > /tmp/memory_metrics.txt"
    }
  }

  # Generate monitoring report
  step "create_dashboard_data" {
    plugin = "file"
    action = "write"
    depends_on = ["check_web_service", "check_api_service", "collect_disk_metrics", "collect_memory_metrics"]
    params = {
      path = "/tmp/monitoring_report.json"
      content = "{\\"timestamp\\": \\"$(date)\\", \\"web_status\\": \\"{{.Steps.check_web_service.output.status_code}}\\", \\"api_status\\": \\"{{.Steps.check_api_service.output.status_code}}\\", \\"threshold\\": \\"{{.Variables.alert_threshold}}\\"}"
    }
  }

  step "archive_results" {
    plugin = "shell"
    action = "exec"
    depends_on = ["create_dashboard_data"]
    params = {
      command = "mkdir -p /tmp/monitoring_archive && cp /tmp/monitoring_report.json /tmp/monitoring_archive/report-$(date +%Y%m%d-%H%M%S).json"
    }
  }
}
EOF`,
                delay: 1000
            },
            {
                type: 'checkpoint',
                text: '<div class="tip-block"><strong>Pro Tips for Practice:</strong><br/>• Start simple and add complexity gradually<br/>• Use <code>corynth plan</code> to visualize dependencies<br/>• Test error scenarios with continue_on settings<br/>• Leverage parallel execution for performance<br/>• Document your workflows with good descriptions</div>',
                delay: 700
            },
            {
                type: 'try-it',
                text: '<div class="try-it"><strong>Your Turn!</strong><br/>Now try running these example workflows:<br/>1. <code>corynth apply challenge1-solution.hcl</code><br/>2. <code>corynth apply challenge2-solution.hcl</code><br/>3. <code>corynth apply challenge3-solution.hcl</code><br/><br/>Then modify them to match your own use cases!</div>',
                delay: 800
            },
            {
                type: 'conclusion',
                text: '<div class="checkpoint"><strong>Advanced Training Complete!</strong><br/><br/><strong>You have Mastered:</strong><br/>• Remote plugin auto-installation and caching<br/>• Parallel execution for performance optimization<br/>• Production-ready error handling and retries<br/>• Real-world workflow orchestration patterns<br/>• Complex dependency management<br/>• Multi-plugin integration workflows<br/><br/><strong>You are now ready to build production-grade automation workflows with Corynth!</strong><br/><br/><strong>Continue learning:</strong><br/>• Explore the community gallery for more examples<br/>• Try building your own custom plugins<br/>• Share your workflows with the community</div>',
                delay: 1000
            }
        ];

        let currentIndex = 0;
        const contentEl = document.getElementById('content');

        function createCopyButton(textToCopy) {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.onclick = function(e) {
                e.stopPropagation();
                navigator.clipboard.writeText(textToCopy).then(() => {
                    copyBtn.textContent = 'Copied';
                    copyBtn.classList.add('clicked');
                    setTimeout(() => {
                        copyBtn.textContent = 'Copy';
                        copyBtn.classList.remove('clicked');
                    }, 2000);
                }).catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    copyBtn.textContent = 'Copied';
                    copyBtn.classList.add('clicked');
                    setTimeout(() => {
                        copyBtn.textContent = 'Copy';
                        copyBtn.classList.remove('clicked');
                    }, 2000);
                });
            };
            return copyBtn;
        }

        function typeText(text, element, callback, speed = 20) {
            let i = 0;
            const typeChar = () => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    if (i % 10 === 0) {
                        const terminal = document.querySelector('.terminal');
                        terminal.scrollTop = terminal.scrollHeight;
                    }
                    i++;
                    setTimeout(typeChar, speed + Math.random() * 10);
                } else {
                    if (callback) callback();
                }
            };
            typeChar();
        }

        function addLine(content, className = '', callback) {
            const lines = content.split('\\n');
            let lineIndex = 0;
            
            function addNextLine() {
                if (lineIndex >= lines.length) {
                    if (callback) callback();
                    return;
                }
                
                const lineContent = lines[lineIndex];
                const line = document.createElement('div');
                line.className = `line fade-in ${className}`;
                
                if (lineContent.trim() === '') {
                    line.innerHTML = '&nbsp;';
                    line.style.minHeight = '12px';
                } else {
                    if (lineContent.includes('<')) {
                        line.innerHTML = lineContent;
                    } else {
                        line.textContent = lineContent;
                    }
                }
                
                contentEl.appendChild(line);
                
                const terminal = document.querySelector('.terminal');
                terminal.scrollTop = terminal.scrollHeight;
                
                lineIndex++;
                setTimeout(addNextLine, 50);
            }
            
            addNextLine();
        }

        function showCommand(cmd, callback) {
            const container = document.createElement('div');
            container.className = 'copyable-line fade-in line';
            
            const promptSpan = document.createElement('span');
            promptSpan.className = 'prompt';
            promptSpan.textContent = '$ ';
            container.appendChild(promptSpan);
            
            const commandSpan = document.createElement('span');
            commandSpan.className = 'command';
            container.appendChild(commandSpan);
            
            const copyBtn = createCopyButton(cmd);
            container.appendChild(copyBtn);
            
            contentEl.appendChild(container);
            
            const terminal = document.querySelector('.terminal');
            terminal.scrollTop = terminal.scrollHeight;
            
            typeText(cmd, commandSpan, () => {
                terminal.scrollTop = terminal.scrollHeight;
                callback();
            }, 30);
        }

        function runLesson() {
            if (currentIndex >= lessonContent.length) return;
            
            const content = lessonContent[currentIndex];
            
            switch(content.type) {
                case 'intro':
                case 'conclusion':
                    addLine(content.text, 'highlight', () => {
                        currentIndex++;
                        setTimeout(runLesson, content.delay);
                    });
                    break;
                    
                case 'explanation':
                case 'checkpoint':
                case 'try-it':
                    addLine(content.text, '', () => {
                        currentIndex++;
                        setTimeout(runLesson, content.delay);
                    });
                    break;
                    
                case 'prompt':
                    showCommand(content.command, () => {
                        currentIndex++;
                        setTimeout(runLesson, content.delay);
                    });
                    break;
                    
                case 'output':
                    addLine(content.text, 'output', () => {
                        currentIndex++;
                        setTimeout(runLesson, content.delay);
                    });
                    break;
            }
        }

        // Interactive controls
        let isPaused = false;
        let lessonInterval;

        function pauseLesson() {
            isPaused = true;
            document.getElementById('pauseOverlay').style.display = 'flex';
        }

        function resumeLesson() {
            isPaused = false;
            document.getElementById('pauseOverlay').style.display = 'none';
        }

        function restartLesson() {
            location.reload();
        }

        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    if (isPaused) {
                        resumeLesson();
                    } else {
                        pauseLesson();
                    }
                    break;
                case 'r':
                case 'R':
                    e.preventDefault();
                    restartLesson();
                    break;
                case 'm':
                case 'M':
                    e.preventDefault();
                    window.location.href = 'training-index.html';
                    break;
                case 'q':
                case 'Q':
                    e.preventDefault();
                    document.querySelector('.terminal').scrollBy(0, -50);
                    break;
                case 'a':
                case 'A':
                    e.preventDefault();
                    document.querySelector('.terminal').scrollBy(0, 50);
                    break;
            }
        });

        setTimeout(runLesson, 1000);
    </script>
</body>
</html>